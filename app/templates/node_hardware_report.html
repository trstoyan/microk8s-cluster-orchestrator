{% extends "base.html" %}

{% block title %}Hardware Report - {{ node.hostname }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1><i class="fas fa-server"></i> {{ node.hostname }}</h1>
                    <p class="text-muted">Detailed Hardware Report</p>
                </div>
                <div>
                    <a href="{{ url_for('web.hardware_report') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> Back to All Nodes
                    </a>
                    <button class="btn btn-primary" onclick="collectNodeHardwareReport({{ node.id }})">
                        <i class="fas fa-sync-alt"></i> Update Report
                    </button>
                </div>
            </div>

            <!-- Basic Info -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card shadow">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary">System Information</h6>
                        </div>
                        <div class="card-body">
                            <table class="table table-sm table-borderless">
                                <tr><th>Hostname:</th><td>{{ node.hostname }}</td></tr>
                                <tr><th>IP Address:</th><td>{{ node.ip_address }}</td></tr>
                                <tr><th>Status:</th><td><span class="badge badge-{{ 'success' if node.status == 'online' else 'secondary' }}">{{ node.status }}</span></td></tr>
                                <tr><th>OS Version:</th><td>{{ node.os_version or 'Unknown' }}</td></tr>
                                <tr><th>Kernel:</th><td>{{ node.kernel_version or 'Unknown' }}</td></tr>
                                <tr><th>Last Seen:</th><td>{{ node.last_seen.strftime('%Y-%m-%d %H:%M:%S') if node.last_seen else 'Never' }}</td></tr>
                                {% if node.cluster %}
                                <tr><th>Cluster:</th><td><a href="{{ url_for('web.cluster_hardware_report', cluster_id=node.cluster.id) }}">{{ node.cluster.name }}</a></td></tr>
                                {% endif %}
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card shadow">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary">Resource Usage</h6>
                        </div>
                        <div class="card-body">
                            {% if node.cpu_usage_percent is not none or node.memory_usage_percent is not none or node.disk_usage_percent is not none %}
                            <div class="mb-3">
                                <label>CPU Usage</label>
                                <div class="progress">
                                    <div class="progress-bar" style="width: {{ node.cpu_usage_percent or 0 }}%">
                                        {{ node.cpu_usage_percent or 0 }}%
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label>Memory Usage</label>
                                <div class="progress">
                                    <div class="progress-bar bg-info" style="width: {{ node.memory_usage_percent or 0 }}%">
                                        {{ node.memory_usage_percent or 0 }}%
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label>Disk Usage</label>
                                <div class="progress">
                                    <div class="progress-bar bg-warning" style="width: {{ node.disk_usage_percent or 0 }}%">
                                        {{ node.disk_usage_percent or 0 }}%
                                    </div>
                                </div>
                            </div>
                            {% if node.load_average %}
                            <p><strong>Load Average:</strong> {{ node.load_average }}</p>
                            {% endif %}
                            {% if node.uptime_seconds %}
                            <p><strong>Uptime:</strong> {{ "%.1f"|format(node.uptime_seconds|int / 86400) }} days</p>
                            {% endif %}
                            {% else %}
                            <p class="text-muted">No usage data available. Click "Update Report" to collect current data.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hardware Details -->
            <div class="row mb-4">
                <!-- CPU Information -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-microchip"></i> CPU Information</h6>
                        </div>
                        <div class="card-body">
                            {% if parsed_info.cpu %}
                            <table class="table table-sm table-borderless">
                                <tr><th>Model:</th><td>{{ parsed_info.cpu.model or 'Unknown' }}</td></tr>
                                <tr><th>Architecture:</th><td>{{ parsed_info.cpu.architecture or 'Unknown' }}</td></tr>
                                <tr><th>Cores:</th><td>{{ parsed_info.cpu.cores or node.cpu_cores or 'Unknown' }}</td></tr>
                                <tr><th>Threads:</th><td>{{ parsed_info.cpu.threads or 'Unknown' }}</td></tr>
                                <tr><th>Frequency:</th><td>{{ parsed_info.cpu.frequency or 'Unknown' }}</td></tr>
                                {% if parsed_info.cpu.cache_info %}
                                <tr><th>Cache:</th><td><small>{{ parsed_info.cpu.cache_info }}</small></td></tr>
                                {% endif %}
                                {% if parsed_info.cpu.usage_percent is not none %}
                                <tr><th>Current Usage:</th><td>{{ parsed_info.cpu.usage_percent }}%</td></tr>
                                {% endif %}
                            </table>
                            {% else %}
                            <p class="text-muted">No detailed CPU information available.</p>
                            <p><strong>Cores:</strong> {{ node.cpu_cores or 'Unknown' }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Memory Information -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-memory"></i> Memory Information</h6>
                        </div>
                        <div class="card-body">
                            {% if parsed_info.memory %}
                            <table class="table table-sm table-borderless">
                                <tr><th>Total:</th><td>{{ parsed_info.memory.total_human or (node.memory_gb ~ ' GB') or 'Unknown' }}</td></tr>
                                <tr><th>Total GB:</th><td>{{ parsed_info.memory.total_gb or node.memory_gb or 'Unknown' }}</td></tr>
                                {% if parsed_info.memory.usage_percent is not none %}
                                <tr><th>Current Usage:</th><td>{{ parsed_info.memory.usage_percent }}%</td></tr>
                                {% endif %}
                                {% if parsed_info.memory.swap_info %}
                                <tr><th>Swap:</th><td><small>{{ parsed_info.memory.swap_info }}</small></td></tr>
                                {% endif %}
                            </table>
                            {% if parsed_info.memory.details %}
                            <div class="mt-3">
                                <strong>Memory Details:</strong>
                                <pre class="small bg-light p-2 mt-2">{{ parsed_info.memory.details }}</pre>
                            </div>
                            {% endif %}
                            {% else %}
                            <p class="text-muted">No detailed memory information available.</p>
                            <p><strong>Total:</strong> {{ node.memory_gb or 'Unknown' }} GB</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mb-4">
                <!-- Disk Information -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-hdd"></i> Storage Information</h6>
                        </div>
                        <div class="card-body">
                            {% if parsed_info.disk %}
                            <table class="table table-sm table-borderless">
                                <tr><th>Total:</th><td>{{ parsed_info.disk.total_gb or node.disk_gb or 'Unknown' }} GB</td></tr>
                                {% if parsed_info.disk.usage_percent is not none %}
                                <tr><th>Current Usage:</th><td>{{ parsed_info.disk.usage_percent }}%</td></tr>
                                {% endif %}
                            </table>
                            {% if parsed_info.disk.layout %}
                            <div class="mt-3">
                                <strong>Disk Layout:</strong>
                                <pre class="small bg-light p-2 mt-2">{{ parsed_info.disk.layout }}</pre>
                            </div>
                            {% endif %}
                            {% if parsed_info.disk.details %}
                            <div class="mt-3">
                                <strong>Disk Details:</strong>
                                <pre class="small bg-light p-2 mt-2">{{ parsed_info.disk.details }}</pre>
                            </div>
                            {% endif %}
                            {% else %}
                            <p class="text-muted">No detailed disk information available.</p>
                            <p><strong>Total:</strong> {{ node.disk_gb or 'Unknown' }} GB</p>
                            {% endif %}
                        </div>
                    </div>
                </div>


            <!-- Detailed Disk and Storage Information -->
            {% if parsed_info.disk_partitions or parsed_info.storage_volumes %}
            <div class="row mb-4">
                <!-- Detailed Disk Partitions -->
                {% if parsed_info.disk_partitions %}
                <div class="col-12 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-hdd"></i> Disk Partitions & Filesystems</h6>
                        </div>
                        <div class="card-body">
                            {% if parsed_info.disk_partitions.physical_disks %}
                            <div class="mb-4">
                                <h6 class="text-dark mb-2"><i class="fas fa-server"></i> Physical Disks</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-bordered">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Device</th>
                                                <th>Size</th>
                                                <th>Type</th>
                                                <th>Model</th>
                                                <th>Serial</th>
                                                <th>Rotational</th>
                                                <th>Transport</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for line in parsed_info.disk_partitions.physical_disks.split('|') %}
                                            {% if line and not line.startswith('NAME') and line.strip() and not line.strip().startswith('loop') %}
                                            {% set cols = line.strip().split() %}
                                            {% if cols|length >= 3 and cols[2] == 'disk' %}
                                            <tr>
                                                <td><code>{{ cols[0] if cols|length > 0 else '' }}</code></td>
                                                <td>{{ cols[1] if cols|length > 1 else '' }}</td>
                                                <td>{{ cols[2] if cols|length > 2 else '' }}</td>
                                                <td>{{ cols[3] if cols|length > 3 else '' }}</td>
                                                <td>{{ cols[4] if cols|length > 4 else '' }}</td>
                                                <td>{{ cols[5] if cols|length > 5 else '' }}</td>
                                                <td>{{ cols[6] if cols|length > 6 else '' }}</td>
                                            </tr>
                                            {% endif %}
                                            {% endif %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if parsed_info.disk_partitions.mounted_filesystems %}
                            <div class="mb-4">
                                <h6 class="text-dark mb-2"><i class="fas fa-folder-open"></i> Mounted Filesystems</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-bordered">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Device</th>
                                                <th>Mount Point</th>
                                                <th>Type</th>
                                                <th>Options</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for line in parsed_info.disk_partitions.mounted_filesystems.split('|') %}
                                            {% if line and ' on ' in line and ' type ' in line and '===' not in line %}
                                            {% set parts = line.strip().split(' on ') %}
                                            {% if parts|length >= 2 %}
                                            {% set device = parts[0].strip() %}
                                            {% set mount_info = parts[1].strip() %}
                                            {% set mount_parts = mount_info.split(' type ') %}
                                            {% if mount_parts|length >= 2 %}
                                            {% set mount_point = mount_parts[0].strip() %}
                                            {% set type_options = mount_parts[1].strip() %}
                                            {% set type_parts = type_options.split(' (') %}
                                            {% set fs_type = type_parts[0].strip() %}
                                            {% set options = type_parts[1].strip().rstrip(')') if type_parts|length > 1 else '' %}
                                            <tr>
                                                <td><code>{{ device }}</code></td>
                                                <td><code>{{ mount_point }}</code></td>
                                                <td>{{ fs_type }}</td>
                                                <td class="small">{{ options }}</td>
                                            </tr>
                                            {% endif %}
                                            {% endif %}
                                            {% endif %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if parsed_info.disk_partitions.all_partitions %}
                            <div class="mb-4">
                                <h6 class="text-dark mb-2"><i class="fas fa-layer-group"></i> All Partitions</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-bordered">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Name</th>
                                                <th>FSType</th>
                                                <th>Label</th>
                                                <th>UUID</th>
                                                <th>Mount Point</th>
                                                <th>Size</th>
                                                <th>Used</th>
                                                <th>Available</th>
                                                <th>Use%</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for line in parsed_info.disk_partitions.all_partitions.split('|') %}
                                            {% if line and line.strip() and not line.strip().startswith('NAME') and not line.strip().startswith('loop') %}
                                            {% set cols = line.strip().split() %}
                                            {% if cols|length >= 2 and not cols[2] == 'disk' and cols[0] and (cols[0].startswith('sda') or cols[0].startswith('sdb') or cols[0].startswith('sdc') or cols[0].startswith('sdd') or cols[0].startswith('sde')) and cols[0] != cols[0].replace('1', '').replace('2', '').replace('3', '').replace('4', '').replace('5', '') %}
                                            <tr>
                                                <td><code>{{ cols[0] if cols|length > 0 else '' }}</code></td>
                                                <td>{{ cols[1] if cols|length > 1 else '' }}</td>
                                                <td>{{ cols[2] if cols|length > 2 else '' }}</td>
                                                <td class="small">{{ cols[3] if cols|length > 3 else '' }}</td>
                                                <td><code>{{ cols[4] if cols|length > 4 else '' }}</code></td>
                                                <td>{{ cols[5] if cols|length > 5 else '' }}</td>
                                                <td>{{ cols[6] if cols|length > 6 else '' }}</td>
                                                <td>{{ cols[7] if cols|length > 7 else '' }}</td>
                                                <td><span class="badge badge-{% if cols[8] and cols[8].replace('%','')|int > 80 %}danger{% elif cols[8] and cols[8].replace('%','')|int > 60 %}warning{% else %}success{% endif %}">{{ cols[8] if cols|length > 8 else '' }}</span></td>
                                            </tr>
                                            {% endif %}
                                            {% endif %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if parsed_info.disk_partitions.lvm_info %}
                            <div class="mb-4">
                                <h6 class="text-dark mb-2"><i class="fas fa-cubes"></i> LVM Information</h6>
                                {% if 'No LVM' in parsed_info.disk_partitions.lvm_info or 'No LVM volumes' in parsed_info.disk_partitions.lvm_info %}
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> No LVM volumes detected on this system.
                                </div>
                                {% else %}
                                <div class="table-responsive">
                                    <table class="table table-sm table-bordered">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>LVM Component</th>
                                                <th>Details</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for line in parsed_info.disk_partitions.lvm_info.split('|') %}
                                            {% if line and line.strip() and 'No LVM' not in line and '===' not in line %}
                                            {% set parts = line.strip().split(' ', 1) %}
                                            {% if parts|length >= 2 %}
                                            <tr>
                                                <td><code>{{ parts[0] if parts|length > 0 else '' }}</code></td>
                                                <td>{{ parts[1] if parts|length > 1 else '' }}</td>
                                            </tr>
                                            {% else %}
                                            <tr>
                                                <td colspan="2"><code>{{ line.strip() }}</code></td>
                                            </tr>
                                            {% endif %}
                                            {% endif %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Storage Volumes (PVCs, PVs, Docker) -->
                {% if parsed_info.storage_volumes %}
                <div class="col-12 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-database"></i> Storage Volumes & PVCs</h6>
                        </div>
                        <div class="card-body">
                            {% if parsed_info.storage_volumes.kubernetes_pvcs %}
                            <div class="mb-4">
                                <h6 class="text-dark mb-2"><i class="fab fa-docker"></i> Kubernetes PVCs</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-bordered">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Name</th>
                                                <th>Status</th>
                                                <th>Volume</th>
                                                <th>Capacity</th>
                                                <th>Access Modes</th>
                                                <th>Storage Class</th>
                                                <th>Age</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% if 'kubectl not available' in parsed_info.storage_volumes.kubernetes_pvcs %}
                                            <tr>
                                                <td colspan="7" class="text-center text-muted">
                                                    <i class="fas fa-exclamation-triangle"></i> kubectl/microk8s kubectl not available - Cannot retrieve PVC information
                                                </td>
                                            </tr>
                                            {% else %}
                                            {% set pvc_section = parsed_info.storage_volumes.kubernetes_pvcs.split('=== MICROK8S PVCs ===') %}
                                            {% if pvc_section|length > 1 %}
                                            {% for line in pvc_section[1].split('|') %}
                                            {% if line and 'No resources found' not in line and '===' not in line and 'DRIVER' not in line and 'NAME' not in line and line.strip() %}
                                            {% set cols = line.strip().split() %}
                                            {% if cols|length >= 2 %}
                                            <tr>
                                                <td><code>{{ cols[0] if cols|length > 0 else '' }}</code></td>
                                                <td><span class="badge badge-{% if cols[1] == 'Bound' %}success{% elif cols[1] == 'Pending' %}warning{% else %}secondary{% endif %}">{{ cols[1] if cols|length > 1 else '' }}</span></td>
                                                <td>{{ cols[2] if cols|length > 2 else '' }}</td>
                                                <td>{{ cols[3] if cols|length > 3 else '' }}</td>
                                                <td>{{ cols[4] if cols|length > 4 else '' }}</td>
                                                <td>{{ cols[5] if cols|length > 5 else '' }}</td>
                                                <td>{{ cols[6] if cols|length > 6 else '' }}</td>
                                            </tr>
                                            {% endif %}
                                            {% endif %}
                                            {% endfor %}
                                            {% endif %}
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if parsed_info.storage_volumes.kubernetes_pvs %}
                            <div class="mb-4">
                                <h6 class="text-dark mb-2"><i class="fas fa-hdd"></i> Kubernetes PVs</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-bordered">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Name</th>
                                                <th>Capacity</th>
                                                <th>Access Modes</th>
                                                <th>Reclaim Policy</th>
                                                <th>Status</th>
                                                <th>Claim</th>
                                                <th>Storage Class</th>
                                                <th>Reason</th>
                                                <th>Age</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% if 'kubectl not available' in parsed_info.storage_volumes.kubernetes_pvs %}
                                            <tr>
                                                <td colspan="9" class="text-center text-muted">
                                                    <i class="fas fa-exclamation-triangle"></i> kubectl/microk8s kubectl not available - Cannot retrieve PV information
                                                </td>
                                            </tr>
                                            {% else %}
                                            {% set pv_section = parsed_info.storage_volumes.kubernetes_pvs.split('=== MICROK8S PVs ===') %}
                                            {% if pv_section|length > 1 %}
                                            {% for line in pv_section[1].split('|') %}
                                            {% if line and 'No resources found' not in line and '===' not in line and 'DRIVER' not in line and 'NAME' not in line and line.strip() %}
                                            {% set cols = line.strip().split() %}
                                            {% if cols|length >= 2 %}
                                            <tr>
                                                <td><code>{{ cols[0] if cols|length > 0 else '' }}</code></td>
                                                <td>{{ cols[1] if cols|length > 1 else '' }}</td>
                                                <td>{{ cols[2] if cols|length > 2 else '' }}</td>
                                                <td>{{ cols[3] if cols|length > 3 else '' }}</td>
                                                <td><span class="badge badge-{% if cols[4] == 'Bound' %}success{% elif cols[4] == 'Available' %}info{% else %}secondary{% endif %}">{{ cols[4] if cols|length > 4 else '' }}</span></td>
                                                <td>{{ cols[5] if cols|length > 5 else '' }}</td>
                                                <td>{{ cols[6] if cols|length > 6 else '' }}</td>
                                                <td>{{ cols[7] if cols|length > 7 else '' }}</td>
                                                <td>{{ cols[8] if cols|length > 8 else '' }}</td>
                                            </tr>
                                            {% endif %}
                                            {% endif %}
                                            {% endfor %}
                                            {% endif %}
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if parsed_info.storage_volumes.kubernetes_pvcs %}
                            <div class="mb-4">
                                <h6 class="text-dark mb-2"><i class="fab fa-docker"></i> Docker Volumes</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-bordered">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Driver</th>
                                                <th>Volume Name</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% set docker_section = parsed_info.storage_volumes.kubernetes_pvcs.split('=== DOCKER VOLUMES ===') %}
                                            {% if docker_section|length > 1 %}
                                            {% for line in docker_section[1].split('|') %}
                                            {% if line and 'DRIVER' not in line and '===' not in line and line.strip() %}
                                            {% set cols = line.strip().split() %}
                                            {% if cols|length >= 2 %}
                                            <tr>
                                                <td><span class="badge badge-info">{{ cols[0] if cols|length > 0 else '' }}</span></td>
                                                <td><code>{{ cols[1] if cols|length > 1 else '' }}</code></td>
                                            </tr>
                                            {% endif %}
                                            {% endif %}
                                            {% endfor %}
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if parsed_info.storage_volumes.storage_classes %}
                            <div class="mb-4">
                                <h6 class="text-dark mb-2"><i class="fas fa-cog"></i> Storage Classes</h6>
                                <div class="table-responsive">
                                    <table class="table table-sm table-bordered">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Name</th>
                                                <th>Provisioner</th>
                                                <th>Reclaim Policy</th>
                                                <th>Volume Binding Mode</th>
                                                <th>Allow Volume Expansion</th>
                                                <th>Age</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for line in parsed_info.storage_volumes.storage_classes.split('\n') %}
                                            {% if line and not line.startswith('NAME') and 'No resources found' not in line %}
                                            <tr>
                                                {% set cols = line.split() %}
                                                <td><code>{{ cols[0] if cols|length > 0 else '' }}</code></td>
                                                <td>{{ cols[1] if cols|length > 1 else '' }}</td>
                                                <td>{{ cols[2] if cols|length > 2 else '' }}</td>
                                                <td>{{ cols[3] if cols|length > 3 else '' }}</td>
                                                <td>{{ cols[4] if cols|length > 4 else '' }}</td>
                                                <td>{{ cols[5] if cols|length > 5 else '' }}</td>
                                            </tr>
                                            {% endif %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}

                <!-- GPU Information -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-tv"></i> GPU Information</h6>
                        </div>
                        <div class="card-body">
                            {% if parsed_info.gpu %}
                            <table class="table table-sm table-borderless">
                                <tr><th>GPU Present:</th><td>
                                    {% if parsed_info.gpu.present %}
                                        <span class="badge badge-success">Yes</span>
                                    {% else %}
                                        <span class="badge badge-secondary">No</span>
                                    {% endif %}
                                </td></tr>
                            </table>
                            {% if parsed_info.gpu.details %}
                            <div class="mt-3">
                                <strong>GPU Details:</strong>
                                <pre class="small bg-light p-2 mt-2">{{ parsed_info.gpu.details }}</pre>
                            </div>
                            {% endif %}
                            {% else %}
                            <p class="text-muted">No GPU information available.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mb-4">
                <!-- Network Information -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-network-wired"></i> Network Information</h6>
                        </div>
                        <div class="card-body">
                            {% if parsed_info.network %}
                            {% if parsed_info.network.interfaces %}
                            <table class="table table-sm table-borderless">
                                <tr><th>Interfaces:</th><td>{{ parsed_info.network.interfaces | length }}</td></tr>
                                <tr><th>Interface List:</th><td>{{ parsed_info.network.interfaces | join(', ') }}</td></tr>
                            </table>
                            {% endif %}
                            {% if parsed_info.network.details %}
                            <div class="mt-3">
                                <strong>Network Details:</strong>
                                <pre class="small bg-light p-2 mt-2" style="max-height: 300px; overflow-y: auto;">{{ parsed_info.network.details }}</pre>
                            </div>
                            {% endif %}
                            {% else %}
                            <p class="text-muted">No detailed network information available.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Temperature Information -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-thermometer-half"></i> Temperature Information</h6>
                        </div>
                        <div class="card-body">
                            {% if parsed_info.thermal %}
                            <table class="table table-sm table-borderless">
                                <tr><th>Sensors Available:</th><td>
                                    {% if parsed_info.thermal.sensors_available %}
                                        <span class="badge badge-success">Yes</span>
                                    {% else %}
                                        <span class="badge badge-secondary">No</span>
                                    {% endif %}
                                </td></tr>
                            </table>
                            {% if parsed_info.thermal.details %}
                            <div class="mt-3">
                                <strong>Temperature Details:</strong>
                                <pre class="small bg-light p-2 mt-2">{{ parsed_info.thermal.details }}</pre>
                            </div>
                            {% endif %}
                            {% else %}
                            <p class="text-muted">No temperature sensor information available.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hardware General Information -->
            {% if parsed_info.hardware %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-cogs"></i> Hardware Details</h6>
                        </div>
                        <div class="card-body">
                            <table class="table table-sm table-borderless">
                                {% if parsed_info.hardware.manufacturer %}
                                <tr><th>Manufacturer:</th><td>{{ parsed_info.hardware.manufacturer }}</td></tr>
                                {% endif %}
                                {% if parsed_info.hardware.model %}
                                <tr><th>Model:</th><td>{{ parsed_info.hardware.model }}</td></tr>
                                {% endif %}
                                {% if parsed_info.hardware.serial %}
                                <tr><th>Serial Number:</th><td>{{ parsed_info.hardware.serial }}</td></tr>
                                {% endif %}
                                {% if parsed_info.hardware.bios_version %}
                                <tr><th>BIOS Version:</th><td>{{ parsed_info.hardware.bios_version }}</td></tr>
                                {% endif %}
                            </table>
                            {% if parsed_info.hardware.devices_summary %}
                            <div class="mt-3">
                                <strong>Connected Devices:</strong>
                                <pre class="small bg-light p-2 mt-2">{{ parsed_info.hardware.devices_summary }}</pre>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function collectNodeHardwareReport(nodeId) {
    const button = event.target.closest('button');
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
    button.disabled = true;
    
    fetch('/api/hardware-report', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({node_id: nodeId})
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
        } else {
            alert('Hardware report collection started. Operation ID: ' + data.operation_id + '\n\nThe page will reload in a few seconds to show updated data.');
            setTimeout(() => location.reload(), 3000);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error collecting hardware report');
    })
    .finally(() => {
        button.innerHTML = originalText;
        button.disabled = false;
    });
}
</script>
{% endblock %}
